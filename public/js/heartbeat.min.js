document.addEventListener("DOMContentLoaded",function(){function e(){fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify({isFocused:t})}).then(e=>{if(e.ok)if(e.redirected&&e.url===n)console.log("User is not authenticated, redirecting to login..."),window.location.href=n;else{if(!window.location.href.includes("/dashboard"))return;e.json().then(e=>{$class="avatar avatar-"+e.data.last_seen+" position-relative",$("#user-avatar").removeClass().addClass($class),$("#user-avatar-drop").removeClass().addClass($class)})}else console.error("Heartbeat failed:",e.statusText),401===e.status&&(window.location.href=n)}).catch(e=>{console.error("Heartbeat failed:",e)})}let t=!0;const o=window.location.origin,a=document.querySelector('meta[property="csrf-token"]').getAttribute("content"),n=document.querySelector('meta[property="login-url"]').getAttribute("content")||o+"/login",r=document.querySelector('meta[property="heartbeat-url"]').getAttribute("content")||o+"/profile/heartbeat";window.addEventListener("visibilitychange",function(){"visible"===document.visibilityState?(t=!0,e()):t=!1}),e(),setInterval(e,12e4)});